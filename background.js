/*! For license information please see background.js.LICENSE.txt */
(()=>{function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function t(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach(function(n){r(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))})}return e}function r(n,t,r){return(t=function(n){var t=function(n){if("object"!=e(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==e(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,c,a,s=[],i=!0,u=!1;try{if(c=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;i=!1}else for(;!(i=(r=c.call(t)).done)&&(s.push(r.value),s.length!==n);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,n)||function(e,n){if(e){if("string"==typeof e)return c(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function a(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function c(t,r,o,c){var a=r&&r.prototype instanceof u?r:u,l=Object.create(a.prototype);return s(l,"_invoke",function(t,r,o){var c,a,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,t){return c=n,a=0,s=e,f.n=t,i}};function p(t,r){for(a=t,s=r,n=0;!d&&u&&!o&&n<l.length;n++){var o,c=l[n],p=f.p,g=c[2];t>3?(o=g===r)&&(s=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=e):c[0]<=p&&((o=t<2&&p<c[1])?(a=0,f.v=r,f.n=c[1]):p<g&&(o=t<3||c[0]>r||r>g)&&(c[4]=t,c[5]=r,f.n=g,a=0))}if(o||t>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),a=l,s=g;(n=a<2?e:s)||!d;){c||(a?a<3?(a>1&&(f.n=-1),p(a,s)):f.n=s:f.v=s);try{if(u=2,c){if(a||(o="next"),n=c[o]){if(!(n=n.call(c,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,a<2&&(a=0)}else 1===a&&(n=c.return)&&n.call(c),a<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=e}else if((n=(d=f.n<0)?s:t.call(r,f))!==i)break}catch(n){c=e,a=1,s=n}finally{u=1}}return{value:n,done:d}}}(t,o,c),!0),l}var i={};function u(){}function l(){}function d(){}n=Object.getPrototypeOf;var f=[][r]?n(n([][r]())):(s(n={},r,function(){return this}),n),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,s(p,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,o,"GeneratorFunction"),s(p),s(p,o,"Generator"),s(p,r,function(){return this}),s(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:c,m:g}})()}function s(e,n,t,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}s=function(e,n,t,r){function c(n,t){s(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(c("next",0),c("throw",1),c("return",2))},s(e,n,t,r)}function i(e,n,t,r,o,c,a){try{var s=e[c](a),i=s.value}catch(e){return void t(e)}s.done?n(i):Promise.resolve(i).then(r,o)}function u(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var c=e.apply(n,t);function a(e){i(c,r,o,a,s,"next",e)}function s(e){i(c,r,o,a,s,"throw",e)}a(void 0)})}}console.log("[CloudHub BG] Background script starting...");var l={encrypt:function(e,n){return u(a().m(function t(){var r,o;return a().w(function(t){for(;;)if(0===t.n){for(r="",o=0;o<e.length;o++)r+=String.fromCharCode(e.charCodeAt(o)^n.charCodeAt(o%n.length));return t.a(2,btoa(r))}},t)}))()},decrypt:function(e,n){return u(a().m(function t(){var r,o,c;return a().w(function(t){for(;;)if(0===t.n){for(r=atob(e),o="",c=0;c<r.length;c++)o+=String.fromCharCode(r.charCodeAt(c)^n.charCodeAt(c%n.length));return t.a(2,o)}},t)}))()},save:function(e,n){var t=this;return u(a().m(function r(){var c,s,i,u,l,d,f,p,g;return a().w(function(r){for(;;)switch(r.n){case 0:c=chrome.runtime.id,s={},i=0,u=Object.entries(n);case 1:if(!(i<u.length)){r.n=4;break}if(l=o(u[i],2),d=l[0],"string"!=typeof(f=l[1])||!f){r.n=3;break}return r.n=2,t.encrypt(f,c);case 2:s[d]=r.v;case 3:i++,r.n=1;break;case 4:return r.n=5,chrome.storage.local.get(["credentials"]);case 5:return p=r.v,(g=p.credentials||{})[e]=s,r.n=6,chrome.storage.local.set({credentials:g});case 6:return r.a(2,!0)}},r)}))()},load:function(e){var n=this;return u(a().m(function t(){var r,c,s,i,u,l,d,f,p,g;return a().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["credentials"]);case 1:if(c=t.v,s=null===(r=c.credentials)||void 0===r?void 0:r[e]){t.n=2;break}return t.a(2,null);case 2:i=chrome.runtime.id,u={},l=0,d=Object.entries(s);case 3:if(!(l<d.length)){t.n=6;break}if(f=o(d[l],2),p=f[0],"string"!=typeof(g=f[1])){t.n=5;break}return t.n=4,n.decrypt(g,i);case 4:u[p]=t.v;case 5:l++,t.n=3;break;case 6:return t.a(2,u)}},t)}))()}},d=function(e){return u(a().m(function n(){var t,r;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,fetch("https://api.digitalocean.com/v2/account",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});case 1:return t=n.v,n.a(2,t.ok);case 2:return n.p=2,r=n.v,console.error("DigitalOcean connection test failed:",r),n.a(2,!1)}},n,null,[[0,2]])}))()},f=function(e,n){return u(a().m(function t(){var r,o,c,s,i;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("https://api.digitalocean.com/v2/droplets",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});case 1:if((r=t.v).ok){t.n=2;break}throw new Error("HTTP ".concat(r.status,": ").concat(r.statusText));case 2:return t.n=3,r.json();case 3:if(o=t.v,c=o.droplets||[],!(s=c.find(function(e){return e.name===n}))){t.n=4;break}return t.a(2,{id:s.id,name:s.name,url:"https://cloud.digitalocean.com/droplets/".concat(s.id)});case 4:return t.a(2,{url:"https://cloud.digitalocean.com/droplets"});case 5:t.n=7;break;case 6:return t.p=6,i=t.v,console.error("Error getting DigitalOcean droplet info:",i),t.a(2,{url:"https://cloud.digitalocean.com/droplets"});case 7:return t.a(2)}},t,null,[[0,6]])}))()},p=function(e){return u(a().m(function n(){var t,r,o,c,s,i,u,l,d;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:n.p=0,t=[],r="https://api.digitalocean.com/v2/droplets",console.log("[CloudHub] Fetching ALL DigitalOcean droplets with pagination...");case 1:return console.log("[CloudHub] Fetching page: ".concat(r)),n.n=2,fetch(r,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});case 2:if((c=n.v).ok){n.n=3;break}throw new Error("HTTP ".concat(c.status,": ").concat(c.statusText));case 3:return n.n=4,c.json();case 4:s=n.v,i=s.droplets||[],t=t.concat(i),console.log("[CloudHub] Fetched ".concat(i.length," droplets. Total so far: ").concat(t.length)),r=(null===(o=s.links)||void 0===o||null===(o=o.pages)||void 0===o?void 0:o.next)||null;case 5:if(r){n.n=1;break}case 6:return console.log("[CloudHub] Finished fetching. Total droplets found: ".concat(t.length)),u=t.map(function(e){var n,t,r,o,c,a,s;return{id:"digitalocean:".concat(e.id),name:e.name,type:"droplet",status:e.status,publicIp:(null===(n=e.networks)||void 0===n||null===(n=n.v4)||void 0===n||null===(n=n.find(function(e){return"public"===e.type}))||void 0===n?void 0:n.ip_address)||null,privateIp:(null===(t=e.networks)||void 0===t||null===(t=t.v4)||void 0===t||null===(t=t.find(function(e){return"private"===e.type}))||void 0===t?void 0:t.ip_address)||null,region:(null===(r=e.region)||void 0===r?void 0:r.name)||(null===(o=e.region)||void 0===o?void 0:o.slug)||null,createdAt:e.created_at,size:(null===(c=e.size)||void 0===c?void 0:c.slug)||null,image:(null===(a=e.image)||void 0===a?void 0:a.name)||(null===(s=e.image)||void 0===s?void 0:s.slug)||null}}),l=t.reduce(function(e,n){var t;return e+((null===(t=n.size)||void 0===t?void 0:t.price_monthly)||0)},0),n.a(2,{dropletCount:t.length,estimatedCost:l.toFixed(2),realCost:l.toFixed(2),resources:u,totalCost:l.toFixed(2)});case 7:return n.p=7,d=n.v,console.error("Error fetching DigitalOcean droplets:",d),n.a(2,{dropletCount:0,estimatedCost:"0.00",realCost:"0.00",resources:[],totalCost:"0.00"})}},n,null,[[0,7]])}))()},g={signRequest:function(e,n,t,r,o,c){var s=this;return u(a().m(function i(){var u,l,d,f,p,g,v,m,h,b,y,C,S,w,k,A,H;return a().w(function(a){for(;;)switch(a.n){case 0:return u="AWS4-HMAC-SHA256",l="".concat(n,".").concat(t,".amazonaws.com"),d=new Date,f=d.toISOString().replace(/[:\-]|\.\d{3}/g,""),p=d.toISOString().substring(0,10).replace(/-/g,""),g="host:".concat(l,"\nx-amz-date:").concat(f,"\n"),v="host;x-amz-date",a.n=1,s.sha256(o||"");case 1:return m=a.v,h="".concat(e,"\n").concat(r,"\n\n").concat(g,"\n").concat(v,"\n").concat(m),b=u,y="".concat(p,"/").concat(t,"/").concat(n,"/aws4_request"),A="".concat(b,"\n").concat(f,"\n").concat(y,"\n"),a.n=2,s.sha256(h);case 2:return H=a.v,C=A.concat.call(A,H),a.n=3,s.getSignatureKey(c.secretAccessKey,p,t,n);case 3:return S=a.v,a.n=4,s.hmacSha256(C,S);case 4:return w=a.v,k="".concat(b," Credential=").concat(c.accessKeyId,"/").concat(y,", SignedHeaders=").concat(v,", Signature=").concat(w),a.a(2,{Host:l,"X-Amz-Date":f,Authorization:k,"Content-Type":"application/x-amz-json-1.1"})}},i)}))()},sha256:function(e){return u(a().m(function n(){var t,r,o;return a().w(function(n){for(;;)switch(n.n){case 0:return t=(new TextEncoder).encode(e),n.n=1,crypto.subtle.digest("SHA-256",t);case 1:return r=n.v,o=Array.from(new Uint8Array(r)),n.a(2,o.map(function(e){return e.toString(16).padStart(2,"0")}).join(""))}},n)}))()},hmacSha256:function(e,n){return u(a().m(function t(){var r,o,c,s,i,u;return a().w(function(t){for(;;)switch(t.n){case 0:return r=new TextEncoder,o="string"==typeof n?r.encode(n):n,c=r.encode(e),t.n=1,crypto.subtle.importKey("raw",o,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);case 1:return s=t.v,t.n=2,crypto.subtle.sign("HMAC",s,c);case 2:return i=t.v,u=Array.from(new Uint8Array(i)),t.a(2,u.map(function(e){return e.toString(16).padStart(2,"0")}).join(""))}},t)}))()},getSignatureKey:function(e,n,t,r){var o=this;return u(a().m(function c(){var s,i,u,l;return a().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,o.hmacSha256Bytes(n,"AWS4".concat(e));case 1:return s=c.v,c.n=2,o.hmacSha256Bytes(t,s);case 2:return i=c.v,c.n=3,o.hmacSha256Bytes(r,i);case 3:return u=c.v,c.n=4,o.hmacSha256Bytes("aws4_request",u);case 4:return l=c.v,c.a(2,l)}},c)}))()},hmacSha256Bytes:function(e,n){return u(a().m(function t(){var r,o,c,s;return a().w(function(t){for(;;)switch(t.n){case 0:return r=new TextEncoder,o="string"==typeof n?r.encode(n):n,c=r.encode(e),t.n=1,crypto.subtle.importKey("raw",o,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);case 1:return s=t.v,t.n=2,crypto.subtle.sign("HMAC",s,c);case 2:return t.a(2,t.v)}},t)}))()},testConnection:function(e){var n=this;return u(a().m(function r(){var o,c,s;return a().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,n.signRequest("POST","sts",e.region||"us-east-1","/","",e);case 1:return o=r.v,r.n=2,fetch("https://sts.".concat(e.region||"us-east-1",".amazonaws.com/"),{method:"POST",headers:t(t({},o),{},{"X-Amz-Target":"AWSSecurityTokenServiceV20110615.GetCallerIdentity"}),body:"{}"});case 2:return c=r.v,r.a(2,c.ok);case 3:return r.p=3,s=r.v,console.error("AWS connection test failed:",s),r.a(2,!1)}},r,null,[[0,3]])}))()},getEC2Instances:function(e){var n=this;return u(a().m(function r(){var o,c,s,i,u,l,d,f,p,g,v,m,h;return a().w(function(r){for(;;)switch(r.p=r.n){case 0:r.p=0,o=e.region&&e.region.trim()&&"all"!==e.region?[e.region]:["us-east-1","us-east-2","us-west-1","us-west-2","eu-west-1","eu-west-2","eu-west-3","eu-central-1","eu-north-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-south-2","ca-central-1","sa-east-1","eu-south-1","eu-south-2","me-south-1","me-central-1","af-south-1","ap-east-1","us-gov-east-1","us-gov-west-1"],console.log("[CloudHub BG] AWS: Will scan ".concat(o.length," regions:"),o.join(", ")),c=[],s=0,i=0,u=o;case 1:if(!(i<u.length)){r.n=11;break}return l=u[i],r.p=2,console.log("[CloudHub BG] AWS: Fetching instances from region ".concat(l)),r.n=3,n.signRequest("POST","ec2",l,"/","Action=DescribeInstances&Version=2016-11-15",e);case 3:return d=r.v,console.log("[CloudHub BG] AWS: Making request to https://ec2.".concat(l,".amazonaws.com/")),r.n=4,fetch("https://ec2.".concat(l,".amazonaws.com/"),{method:"POST",headers:t(t({},d),{},{"Content-Type":"application/x-www-form-urlencoded"}),body:"Action=DescribeInstances&Version=2016-11-15"});case 4:if(f=r.v,console.log("[CloudHub BG] AWS: Response status for ".concat(l,": ").concat(f.status," ").concat(f.statusText)),!f.ok){r.n=6;break}return r.n=5,f.text();case 5:p=r.v,console.log("[CloudHub BG] AWS: Received XML response from ".concat(l," (").concat(p.length," chars)")),console.log("[CloudHub BG] AWS: XML preview:",p.substring(0,500)),p.includes("<instancesSet>")&&p.includes("<instanceId>")&&(console.log("[CloudHub BG] AWS: FULL XML DUMP for ".concat(l,":")),console.log(p)),g=n.parseEC2Response(p,l),console.log("[CloudHub BG] AWS: Parsed ".concat(g.length," instances from ").concat(l)),0===g.length&&p.includes("<instancesSet>")&&(console.log("[CloudHub BG] AWS: Warning - XML contains instancesSet but parsed 0 instances. XML length: ".concat(p.length)),console.log("[CloudHub BG] AWS: First 1000 chars:",p.substring(0,1e3))),c=c.concat(g),s+=25*g.length,r.n=8;break;case 6:return r.n=7,f.text();case 7:v=r.v,console.error("[CloudHub BG] AWS: Error response from ".concat(l,":"),v);case 8:r.n=10;break;case 9:r.p=9,m=r.v,console.log("[CloudHub BG] AWS: Failed to get instances from region ".concat(l,":"),m);case 10:i++,r.n=1;break;case 11:return console.log("[CloudHub BG] AWS: Scanning complete. Found ".concat(c.length," instances across ").concat(o.length," regions")),r.a(2,{ec2Count:c.length,estimatedCost:s.toFixed(2),resources:c});case 12:return r.p=12,h=r.v,console.error("Error fetching AWS EC2 instances:",h),r.a(2,{ec2Count:0,estimatedCost:"0.00",resources:[]})}},r,null,[[2,9],[0,12]])}))()},parseEC2Response:function(e,n){var t=this,r=[];try{console.log("[CloudHub BG] AWS: Starting to parse XML for region ".concat(n));var o=e.match(/<instancesSet>[\s\S]*?<\/instancesSet>/g)||[];console.log("[CloudHub BG] AWS: Found ".concat(o.length," instancesSet blocks")),o.forEach(function(e){console.log("[CloudHub BG] AWS: instancesSet XML preview:",e.substring(0,300));var o=e.match(/<item>[\s\S]*?<\/item>/g)||[];console.log("[CloudHub BG] AWS: Found ".concat(o.length," instance items in this instancesSet")),o.forEach(function(e){var o=t.extractXmlValue(e,"instanceId"),c=t.extractXmlValue(e,"instanceType"),a=e.match(/<instanceState>([\s\S]*?)<\/instanceState>/),s="unknown";a&&(s=t.extractXmlValue(a[1],"name")||"unknown");var i=t.extractXmlValue(e,"ipAddress"),u=t.extractXmlValue(e,"launchTime");console.log("[CloudHub BG] AWS: Found instance ".concat(o,", type: ").concat(c,", state: ").concat(s));var l=o,d=e.match(/<tagSet>([\s\S]*?)<\/tagSet>/);d&&(d[1].match(/<item>[\s\S]*?<\/item>/g)||[]).forEach(function(e){var n=t.extractXmlValue(e,"key"),r=t.extractXmlValue(e,"value");"Name"===n&&r&&(l=r)}),console.log("[CloudHub BG] AWS: Instance details - ID: ".concat(o,", Name: ").concat(l,", Type: ").concat(c,", State: ").concat(s,", IP: ").concat(i||"none")),o&&r.push({id:"aws:".concat(o),name:l||o,type:c||"unknown",status:s,publicIp:i||null,region:n,createdAt:u})})})}catch(e){console.error("Error parsing EC2 XML response:",e)}return r},extractXmlValue:function(e,n){var t=new RegExp("<".concat(n,"[^>]*>([^<]*)</").concat(n.split(".*?")[0],">"),"i"),r=e.match(t);return r?r[1].trim():null}};chrome.runtime.onMessage.addListener(function(e,n,t){return console.log("[CloudHub BG] Message received:",e),u(a().m(function n(){var r,o,c,s,i,u,v,m,h,b,y,C,S,w,k,A,H,B,G,O,E,T,j,I,P;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:n.p=0,E=e.action,n.n="saveCredentials"===E?1:"testConnection"===E?3:"getProviderDetails"===E?14:"refreshAllProviders"===E?22:"getDropletSSHInfo"===E?31:"simulateSSHClick"===E?36:"performResourceAction"===E?48:59;break;case 1:return console.log("[CloudHub BG] Saving credentials for ".concat(e.provider)),n.n=2,l.save(e.provider,e.credentials);case 2:return console.log("[CloudHub BG] Credentials saved for ".concat(e.provider)),t({success:!0}),n.a(3,60);case 3:if(console.log("[CloudHub BG] Testing connection for ".concat(e.provider)),r=!1,"digitalocean"!==e.provider){n.n=7;break}return n.n=4,l.load("digitalocean");case 4:if(null==(o=n.v)||!o.token){n.n=6;break}return n.n=5,d(o.token);case 5:r=n.v;case 6:n.n=13;break;case 7:if("aws"!==e.provider){n.n=11;break}return n.n=8,l.load("aws");case 8:if(null==(c=n.v)||!c.accessKeyId||null==c||!c.secretAccessKey){n.n=10;break}return n.n=9,g.testConnection(c);case 9:r=n.v;case 10:n.n=13;break;case 11:return n.n=12,l.load(e.provider);case 12:s=n.v,r=null!==s;case 13:return console.log("[CloudHub BG] Connection test result for ".concat(e.provider,":"),r),t({success:r,error:r?null:"Connection failed"}),n.a(3,60);case 14:if(console.log("[CloudHub BG] Getting provider details for ".concat(e.provider)),i={dropletCount:0,ec2Count:0,computeCount:0,vmCount:0,estimatedCost:"0.00",resources:[]},"digitalocean"!==e.provider){n.n=18;break}return n.n=15,l.load("digitalocean");case 15:if(null==(u=n.v)||!u.token){n.n=17;break}return n.n=16,p(u.token);case 16:i=n.v;case 17:n.n=21;break;case 18:if("aws"!==e.provider){n.n=21;break}return n.n=19,l.load("aws");case 19:if(null==(v=n.v)||!v.accessKeyId||null==v||!v.secretAccessKey){n.n=21;break}return n.n=20,g.getEC2Instances(v);case 20:i=n.v;case 21:return console.log("[CloudHub BG] Provider data for ".concat(e.provider,":"),i),t({success:!0,data:i}),n.a(3,60);case 22:return console.log("[CloudHub BG] Refreshing all providers"),m={},n.n=23,l.load("digitalocean");case 23:if(null==(h=n.v)||!h.token){n.n=25;break}return n.n=24,p(h.token);case 24:m.digitalocean=n.v,n.n=26;break;case 25:m.digitalocean={dropletCount:0,estimatedCost:"0.00",resources:[]};case 26:return n.n=27,l.load("aws");case 27:if(null==(b=n.v)||!b.accessKeyId||null==b||!b.secretAccessKey){n.n=29;break}return n.n=28,g.getEC2Instances(b);case 28:m.aws=n.v,n.n=30;break;case 29:m.aws={ec2Count:0,estimatedCost:"0.00",resources:[]};case 30:return m.gcp={computeCount:0,estimatedCost:"0.00",resources:[]},m.azure={vmCount:0,estimatedCost:"0.00",resources:[]},t({success:!0,data:m}),n.a(3,60);case 31:return console.log("[CloudHub BG] Getting SSH info for droplet: ".concat(e.dropletName)),n.n=32,l.load("digitalocean");case 32:if(null==(y=n.v)||!y.token){n.n=34;break}return n.n=33,f(y.token,e.dropletName);case 33:C=n.v,t({success:!0,dropletUrl:C.url}),n.n=35;break;case 34:t({success:!1,error:"No DigitalOcean credentials found"});case 35:return n.a(3,60);case 36:if(console.log("[CloudHub BG] Simulating SSH click for ".concat(e.provider," instance: ").concat(e.instanceName)),"digitalocean"!==e.provider){n.n=41;break}return console.log("[CloudHub BG] Opening DigitalOcean droplet console for ".concat(e.instanceName," (").concat(e.instanceId,")")),S="https://cloud.digitalocean.com/droplets/".concat(e.instanceId,"/terminal/ui/?os_user=root"),n.p=37,n.n=38,chrome.tabs.create({url:S,active:!0});case 38:console.log("[CloudHub BG] Opened SSH terminal for ".concat(e.instanceName," at ").concat(S)),t({success:!0,message:"SSH terminal opened for ".concat(e.instanceName),action:"terminal_opened",terminalUrl:S}),n.n=40;break;case 39:n.p=39,T=n.v,console.error("[CloudHub BG] Error opening SSH terminal:",T),t({success:!1,error:"Failed to open SSH terminal: ".concat(T.message)});case 40:n.n=47;break;case 41:if("aws"!==e.provider){n.n=46;break}return console.log("[CloudHub BG] Opening AWS EC2 Instance Connect for ".concat(e.instanceName," (").concat(e.instanceId,")")),w=e.region||"us-east-1",k=e.osUser||"ubuntu",A="https://".concat(w,".console.aws.amazon.com/ec2-instance-connect/ssh?region=").concat(w,"&connType=standard&instanceId=").concat(e.instanceId,"&osUser=").concat(k,"&sshPort=22&addressFamily=ipv4"),n.p=42,n.n=43,chrome.tabs.create({url:A,active:!0});case 43:console.log("[CloudHub BG] Opened AWS EC2 Instance Connect for ".concat(e.instanceName," at ").concat(A)),t({success:!0,message:"AWS EC2 Instance Connect opened for ".concat(e.instanceName),action:"instance_connect_opened",instanceConnectUrl:A}),n.n=45;break;case 44:n.p=44,j=n.v,console.error("[CloudHub BG] Error opening AWS EC2 Instance Connect:",j),t({success:!1,error:"Failed to open AWS EC2 Instance Connect: ".concat(j.message)});case 45:n.n=47;break;case 46:t({success:!1,error:"SSH simulation not implemented for ".concat(e.provider)});case 47:return n.a(3,60);case 48:if(console.log("[CloudHub BG] Performing resource action: ".concat(e.resourceAction," on ").concat(e.resourceId)),"delete"!==e.resourceAction||!e.resourceId.startsWith("digitalocean:")){n.n=57;break}return H=e.resourceId.replace("digitalocean:",""),n.n=49,l.load("digitalocean");case 49:if(null!=(B=n.v)&&B.token){n.n=50;break}return t({success:!1,error:"DigitalOcean credentials not found"}),n.a(3,60);case 50:return n.p=50,console.log("[CloudHub BG] Deleting DigitalOcean droplet ".concat(H)),n.n=51,fetch("https://api.digitalocean.com/v2/droplets/".concat(H),{method:"DELETE",headers:{Authorization:"Bearer ".concat(B.token),"Content-Type":"application/json"}});case 51:if(!(G=n.v).ok&&204!==G.status){n.n=52;break}console.log("[CloudHub BG] Successfully deleted droplet ".concat(H)),t({success:!0,message:"Droplet ".concat(H," deleted successfully")}),n.n=54;break;case 52:return n.n=53,G.text();case 53:O=n.v,console.error("[CloudHub BG] Failed to delete droplet ".concat(H,":"),O),t({success:!1,error:"Failed to delete droplet: HTTP ".concat(G.status)});case 54:n.n=56;break;case 55:n.p=55,I=n.v,console.error("[CloudHub BG] Error deleting droplet ".concat(H,":"),I),t({success:!1,error:"Error deleting droplet: ".concat(I.message)});case 56:n.n=58;break;case 57:t({success:!1,error:"Unsupported resource action: ".concat(e.resourceAction," for ").concat(e.resourceId)});case 58:return n.a(3,60);case 59:console.log("[CloudHub BG] Unknown action: ".concat(e.action)),t({success:!1,error:"Unknown action"});case 60:n.n=62;break;case 61:n.p=61,P=n.v,console.error("[CloudHub BG] Error handling message:",P),t({success:!1,error:P.message});case 62:return n.a(2)}},n,null,[[50,55],[42,44],[37,39],[0,61]])}))(),!0}),console.log("[CloudHub BG] Background script loaded successfully")})();